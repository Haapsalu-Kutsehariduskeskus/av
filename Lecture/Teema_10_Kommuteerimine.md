# Teema 10: Kommuteerimine ja Kommutaatori t√∂√∂p√µhim√µtted

## Sissejuhatus

Kommuteerimine on v√µrguliikluse haldamise meetod, mis toimub OSI mudeli teisel kihil. See on fundamentaalne tehnoloogia, mis v√µimaldab arvutiv√µrkudel efektiivselt toimida. Kommuteerimine p√µhineb MAC-aadresside kasutamisel ja v√µimaldab luua otse√ºhendusi erinevate v√µrguseadmete vahel.

## Sild (Bridge)

![Networking: Bridge vs Switch](https://www.techtarget.com/rms/onlineimages/networking-bridge_vs_switch.png)

[Source: TechTarget](https://www.techtarget.com/rms/onlineimages/networking-bridge_vs_switch.png)


Sild oli esimene seade, mis v√µimaldas v√µrguliikluse intelligentset suunamist. See oli revolutsiooniline lahendus 1980ndate l√µpus ja 1990ndate alguses.

```mermaid
graph LR
    A[Segment 1] --- B[Bridge] --- C[Segment 2]
    style B fill:#f9f,stroke:#333,stroke-width:4px
```

### Silla p√µhifunktsioonid:
1. **Segmentide √ºhendamine**: Sild v√µimaldas √ºhendada kaks v√µi kolm eraldi v√µrgusegmenti
2. **MAC-aadresside √µppimine**: J√§lgis, millised seadmed on millisel pordil
3. **Liikluse filtreerimine**: Edastas andmeid ainult vajalikku segmenti

Sild t√∂√∂tas j√§rgmiselt:
- Kui sild sai kaadri, anal√º√ºsis ta selle l√§hte- ja sihtaadressi
- Kui sihtaadress oli tundmatud, saadeti kaader k√µigisse segmentidesse
- Kui sihtaadress oli teada, saadeti kaader ainult √µigesse segmenti
- See v√§hendas oluliselt v√µrgu koormust ja parandas j√µudlust

## Kommutaator

**Ethernet-segmentide kommuteerimise tehnoloogia** t√∂√∂tati v√§lja ettev√µtte **Kalpana** poolt 1990. aastal vastusena kasvavatele n√µudmistele suurendada suure j√µudlusega serverite ja t√∂√∂jaamade segmentide √ºhenduste l√§bilaskev√µimet.

1994. aastal andis ettev√µte **IDC** oma m√§√§ratluse lokaalse v√µrgu kommutaatorile:  
kommutaator ‚Äì **see on seade, mis on konstruktsiooniliselt teostatud v√µrgu HUBina ja toimib kui k√µrge kiirusega mitme pordiga sild**;  
kommuteerimismehhanism v√µimaldab **lokaalv√µrgu segmentimist** ning ribalaiuse jaotamist v√µrgu l√µppjaamadele.

Funktsionaalselt t√∂√∂tab mitmepordiline kommutaator kui mitmepordiline sild, see t√§hendab, et see t√∂√∂tab kanali tasemel, anal√º√ºsib raamide p√§iseid, loob automaatselt **aadressitabeli** ja suunab selle tabeli alusel kaadreid vastavatesse v√§ljundportidesse v√µi filtreerib need, eemaldades need puhvrist.

![Cisco Network Diagram](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.ciscopress.com%2Fcontent%2Fimages%2Fchap7_9780136633662%2FelementLinks%2F07fig16_alt.jpg&f=1&nofb=1&ipt=23c9de4a86e4b15260b1d3e0cfb981245a72e5553446c0d7d18c719c10a16bbd&ipo=images)

Source: [Managing MAC Address Table](https://www.ciscopress.com/)

![Cisco Network Diagram](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2F1.bp.blogspot.com%2F-PFg2GAOii7E%2FXgoh1Cx9toI%2FAAAAAAAAABQ%2FS-ovwdlHnEcCFivDcNoyzgxoRXfZP7HEQCLcBGAsYHQ%2Fs1600%2FPacket%252Bat%252BSwitch%252Bfrom%252BPC2%252Bto%252BSwitch.jpg&f=1&nofb=1&ipt=b794d18eebf9bc65674fb700995292d048290aeced3ac202042a41f50fb8e5eb&ipo=images)

Source: [How Switch Learns MAC Address of Connected Devices in LAN](https://www.ciscopress.com/)

### V√µrdlus jaoturiga (Hub):

| Omadus | Kommutaator | Hub |
|---------|------------|-----|
| Liikluse suunamine | Intelligentne, portip√µhine | K√µikidesse portidesse |
| Kollisioonid | Puuduvad | Sagedased |
| Duplex re≈æiim | T√§isduplex v√µimalik | Ainult half-duplex |
| J√µudlus | K√µrge, portip√µhine | Madal, jagatud |
| MAC-aadresside √µppimine | Jah | Ei |

### Kommutaatori t√∂√∂p√µhim√µte:

Kommutaator √µpib pidevalt v√µrgu kohta:
1. Salvestab l√§hte-MAC-aadressid ja pordid
2. Loob d√ºnaamilise MAC-tabeli
3. Kasutab seda tabelit edasiste otsuste tegemiseks
4. V√§rskendab tabelit vastavalt vajadusele

```mermaid
graph TD
    A[Kaader saabub] --> B{MAC teada?}
    B -->|Jah| C[Saada konkreetsesse porti]
    B -->|Ei| D[Saada k√µikidesse portidesse]
    C --> E[Uuenda MAC-tabelit]
    D --> E
```

## MAC-tabel

MAC-tabel on kommutaatori "aju", mis sisaldab infot seadmete asukoha kohta v√µrgus.

### MAC-tabeli n√§ide:

| MAC-aadress | Port | T√º√ºp | Aeg |
|-------------|------|------|-----|
| 00:1A:2B:3C | 1 | Dynamic | 300s |
| 00:4D:5E:6F | 2 | Static | - |
| 00:7G:8H:9I | 3 | Dynamic | 250s |

MAC-tabeli haldamine toimub d√ºnaamiliselt:
- Uued seadmed lisatakse automaatselt
- Mitteaktiivsed kirjed aeguvad
- Staatilised kirjed s√§ilivad taask√§ivitamisel


## K√ºsimus üßê
Kui **MAC-tabelis** puudub seadme **MAC-aadress**, mida see t√§hendab? Mis v√µiks olla valesti?
### Vihjed üí°
- **Switchid** √µpivad MAC-aadresse, kui nad saavad liiklust seadmelt.

## MTU ja Jumbo kaadrid

MTU (Maximum Transmission Unit) m√§√§rab suurima v√µimaliku andmepaketi suuruse.

### Ethernet kaadri struktuur:
```
+----------------+----------------+----------+---------+
| Destination MAC| Source MAC    | Type     | Payload |
| (6 bytes)      | (6 bytes)     | (2 bytes)| (1500 B)|
+----------------+----------------+----------+---------+
```

Jumbo kaadrid v√µimaldavad suuremat andmemahtu:
- Tavaline MTU: 1518 baiti
- Jumbo kaadrid: kuni 9000 baiti

Kasutamine:
- Andmekeskused
- Varunduss√ºsteemid
- Suure j√µudlusega v√µrgud

## Cisco Switch Operation üîß

Lisainfo Cisco switchide t√∂√∂p√µhim√µtete kohta:  
[Cisco Switch Operation ‚Äì Flackbox](https://www.youtube.com/watch?v=o4xkvyZnhj4)  

[![Cisco Switch Operation ‚Äì Flackbox](https://img.youtube.com/vi/o4xkvyZnhj4/0.jpg)](https://www.youtube.com/watch?v=o4xkvyZnhj4)

## üßë‚Äçüíª K√ºsimus: ü§î

Kui **MAC-tabelis** on juba olemas soovitud seadme **MAC-aadress**, kas siis saadetakse **ARP-p√§ring (ARP Request)** v√µi mitte?  

## MAC Attack

[Loe lisaks MAC Flooding - Wikipedia](https://en.wikipedia.org/wiki/MAC_flooding)

![MAC Flooding](https://1.bp.blogspot.com/-3O0I18aAtbA/VIqn2xvFTTI/AAAAAAAAAUw/HVlz8xuwLyw/s1600/%EA%B7%B8%EB%A6%BC3.jpg)  

## Cisco Ios Show Mac Address Table 

![The output of the show mac address-table command](https://itexamanswers.net/wp-content/uploads/2019/05/2019-05-03_131540.png)

## Erinevate tootjate MAC-tabelid  

**Static** ‚Äì K√§sitsi m√§√§ratud MAC-aadress, mis j√§√§b p√ºsima. Kasutatakse turvalisuse tagamiseks.  

**Dynamic** ‚Äì Switch √µpib aadressi automaatselt ja eemaldab selle, kui liiklust pole.  

## üßë‚Äçüíª K√ºsimus: Kas pordi taga v√µib olla mitu MAC-aadressi?  
Jah, v√µib!  
üí° Kui mitu seadet jagavad sama pordi, peab l√ºliti teadma, kuhu andmepaketid saata! üöÄ

### Cisco kommutaator:
```
Switch# show mac address-table
VLAN  MAC Address      Type     Port
----  -------------   -------  --------
1     00:1A:2B:3C:4D  DYNAMIC  Gi0/1
1     00:4D:5E:6F:7G  STATIC   Gi0/2
```

### Juniper kommutaator:
```
user@switch> show ethernet-switching table
MAC Address       VLAN     Type     Age Port
00:1A:2B:3C:4D   default  dynamic  0   ge-0/0/1
00:4D:5E:6F:7G   default  static   -   ge-0/0/2
```

### D-Link kommutaator:
```
DGS-1210# show fdb
VID  MAC Address      Type     Port
----  -------------   -------  --------
1    00:1A:2B:3C:4D  Dynamic  1
1    00:4D:5E:6F:7G  Static   2
```

## Leviedastuse domeen ( Broadcast domain)

### See on v√µrgu piirkond, kus toimub leviedastuss√µnumite vahetus ja seadmed saavad √ºksteisele otse s√µnumeid saata.  

N√§iteks, kui teie arvuti saadab v√µrku leviedastusp√§ringu, otsides DHCP-serverit, siis see raam (ehk kaader) on adresseeritud k√µigile seadmetele ja selle sihtkoha MAC-aadress on **FF:FF:FF:FF:FF:FF**.  

1Ô∏è‚É£ **Esimene samm:** Kaader j√µuab **kommutaatrisse** (switchi), mis saadab selle koopiad k√µigile oma portidele.  
2Ô∏è‚É£ **Teine samm:** Osa koopiatest j√µuab teistesse **arvutitesse**, osa liigub edasi **naaberl√ºlititesse**.  
3Ô∏è‚É£ **Kolmas samm:** M√µned koopiad j√µuavad **ruuterini**, kuid l√µpuks saab √ºhe koopia **DHCP-server** ja vastab p√§ringule.  


![Broadcast vs Collision Domain](https://www.networkacademy.io/sites/default/files/inline-images/Broadcast%20Domain%20Two%20Switches_0.gif)  

## **Leviedastuse domeeni omadused:**  
‚úÖ Piiratud marsruuteritega  
‚úÖ Sisaldab k√µiki √ºhendatud kommutaatoreid  
‚úÖ M√µjutab v√µrgu j√µudlust  
‚úÖ Vajab hoolikat planeerimist  

## **Probleemid suures leviedastuse domeenis:**  
‚ö†Ô∏è Suur v√µrguliiklus  
‚ö†Ô∏è Seadmete aeglane reageerimine  
‚ö†Ô∏è Ressursside raiskamine  
‚ö†Ô∏è Turvariski suurenemine  

[![Blinking Ethernet Switch Lights](https://img.youtube.com/vi/BuzYB78cmcQ/0.jpg)](https://www.youtube.com/watch?v=BuzYB78cmcQ)  
Source: [YouTube - Blinking Ethernet Switch Lights](https://www.youtube.com/watch?v=BuzYB78cmcQ)

## üßë‚Äçüíª K√ºsimus:

üîé Mida need vilkuvad tuled v√µrgu l√ºlitil (switch) t√§hendavad?

### **V√µrgusilmused (Network Loops)**

V√µrgusilmused on √ºks t√µsisemaid probleeme kommuteeritud v√µrkudes. Need tekivad siis, kui v√µrgus on mitu f√º√ºsilist v√µi loogilist teed samadele sihtpunktidele ning puudub mehhanism, mis takistaks l√µputut liikluse edastamist. 

Kui kommutaatorid (switchid) saadavad pidevalt pakette edasi-tagasi ilma nende teekonda l√µpetamata, p√µhjustab see v√µrgu √ºlekoormust ja v√µib viia t√§ieliku v√µrgukatkestuseni. Selline olukord on tuntud kui **braodcast storm** (ringh√§√§lingutorm), kus v√µrk t√§itub tarbetute pakettidega, aeglustades v√µi peatades kogu liikluse.

![Network Loops](https://www.learncisco.net/wp-content/themes/learncisco/assets/images/icnd1/34-network-loops.jpg)

## ‚ö† **ETTEVAATUST: SWITCHI SILMUSED ON KEELATUD!** ‚ö†  

**V√µrgusilmused (switch loops) on t√µsine oht kommuteeritud v√µrkudele ning need on KEELATUD!**  
Kui v√µrgus tekib silmus, v√µib see p√µhjustada v√µrgu √ºlekoormuse, seadmete hangumise ja isegi t√§ieliku v√µrgu rivist v√§lja langemise.  

---

### **Kuidas v√µrgusilmus v√µib tekkida?**  

#### üî¥ **Tahtlikult (pahatahtlik v√µi eksperimentaalne testimine)**  
- Keegi √ºhendab v√µrgukaabli kahe switchi pordi vahel ilma STP kaitseta.  
- K√§sitsi luuakse L2-silmus vigase konfiguratsiooni v√µi testimise eesm√§rgil.  
- Tahtlikult eemaldatakse STP v√µi Loop Guard kaitse, et ‚Äûn√§ha, mis juhtub‚Äú.  

#### üî¥ **Juhuslikult ja teadmatusest**  
- Kasutaja √ºhendab kogemata kaabli tagasi samasse v√µrku, luues f√º√ºsilise silmuse.  
- Vale switchi seadistamine, n√§iteks STP v√§lja l√ºlitamine teadmatusest.  
- Kahe v√µi enama switchi √ºhendamine ilma STP-d v√µi muud kaitset kasutamata.  

---

### **Silmuste tagaj√§rjed**  
1Ô∏è‚É£ **Broadcast storm** ‚Äì leviedastuse paketid ringlevad l√µputult, p√µhjustades √ºlekoormust.  
2Ô∏è‚É£ **MAC-tabeli ebastabiilsus** ‚Äì MAC-aadressid ‚Äûh√ºppavad‚Äú portide vahel, p√µhjustades segadust.  
3Ô∏è‚É£ **V√µrgu √ºlekoormatus** ‚Äì v√µrguressursid ammenduvad ning seadmed muutuvad aeglaseks.  
4Ô∏è‚É£ **Seadmete k√§ttesaamatus** ‚Äì v√µrk muutub kasutusk√µlbmatuks, katkestades teenused.  

![Topology_Lab7](/Lecture/media/looping_storm.webp)
[![Network Loop Explained](https://img.youtube.com/vi/K0olpgiQNC8/0.jpg)](https://www.youtube.com/watch?v=K0olpgiQNC8)

---

### **Ennetamine**  
‚úÖ **Spanning Tree Protocol (STP)** ‚Äì hoiab √§ra silmuste tekkimise, blokeerides liigsed teed.  
‚úÖ **Hoolikas v√µrgu planeerimine** ‚Äì v√§ltida mittevajalikke √ºhendusi ja tagada korrektne arhitektuur.  
‚úÖ **Port Security seadistused** ‚Äì piirata seadmete arvu, mis v√µivad kindlale pordile √ºhenduda.  
‚úÖ **Regulaarne monitooring** ‚Äì j√§lgida v√µrgu logisid ja liiklust, et avastada potentsiaalseid silmuseid enne, kui need probleeme tekitavad.  

---

## Standardsed ikoonid ( Switch)

V√µrguskeemidel kasutatakse standardseid ikoone erinevate seadmete t√§histamiseks.

![Standardsed ikoonid](https://i.pinimg.com/originals/bb/cd/5e/bbcd5ec286899f534f7ff78b605b96dd.png)
